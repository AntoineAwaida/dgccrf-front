{"ast":null,"code":"var _jsxFileName = \"/Users/antoine/Documents/DGCCRF/dgccrf-front/src/containers/visiteCreation/createVisite.container.js\";\n\n/* eslint-disable no-undef */\nimport React from 'react';\nimport { Form, Grid, GridRow, GridColumn, Icon, TextArea, Button, Message, Container } from 'semantic-ui-react';\nimport { DateInput } from 'semantic-ui-calendar-react';\nimport { Link } from 'react-router-dom';\nimport { PropTypes } from 'prop-types';\nimport { changeNameOfPage, changeBackUrl, changeActivePage } from '../navbar/actions';\nimport { connect } from 'react-redux';\nimport PouchDbServices from '../../services';\nimport ControleComponent from './controles.container';\nlet visitesService = PouchDbServices.services.visite;\nlet dossierService = PouchDbServices.services.dossier;\n\nfunction mapStateToProps(state) {\n  return {\n    agentIdent: state.dataReducer.AGENT_DD_IDENT\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    changeNameOfPage: newName => dispatch(changeNameOfPage(newName)),\n    changeBackUrl: newBackUrl => dispatch(changeBackUrl(newBackUrl)),\n    changeActivePage: value => dispatch(changeActivePage('mesDossiers', '/nouvelle-visite/' + value))\n  };\n}\n\nclass CreateVisiteComponent extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.displayMessage = message => {\n      if (message) {\n        return React.createElement(Message, {\n          fluid: true,\n          negative: true,\n          onDismiss: () => this.setState({\n            message: ''\n          }),\n          style: {\n            marginTop: '10px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        }, React.createElement(Message.Header, {\n          style: {\n            marginBottom: '5px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 93\n          },\n          __self: this\n        }, \"Validation Impossible\"), React.createElement(Message.Content, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96\n          },\n          __self: this\n        }, message));\n      }\n    };\n\n    this.state = {\n      cpmm: false,\n      mutualisee: false,\n      date: '',\n      etab: '',\n      SIRET: '',\n      observations: '',\n      trame: '',\n      trameList: [{\n        _id: 0,\n        name: 'Aucune trame'\n      }],\n      controlesList: [],\n      message: '',\n      dossierText: ''\n    };\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  async componentDidMount() {\n    this.props.changeNameOfPage('Création de visite');\n    this.props.changeBackUrl('/mes-dossiers'); // TODO : change for /dossier/:idDossier\n\n    this.props.changeActivePage(this.props.match.params.dossierId);\n    dossierService.getAllActionCode().then(actionList => this.setState({\n      actionList\n    }));\n    PouchDbServices.services.trame.getAllDocs().then(res => {\n      this.setState({\n        trameList: this.state.trameList.concat(res)\n      });\n    }).catch(e => {//\n    });\n    const dossier = await dossierService.getDossierById(this.props.match.params.dossierId);\n    this.setState({\n      dossierText: dossier.DOSSIER_LIBELLE\n    });\n  }\n\n  testEntries() {\n    if (!this.state.etab || !this.state.date || !this.state.trame) {\n      this.setState({\n        message: \"Veillez renseigner l'ensemble des champs obligatoires\"\n      });\n      return false;\n    }\n\n    if (this.state.SIRET.length !== 14) {\n      this.setState({\n        message: \"Le numéro SIRET renseigné n'est pas valide : il doit être composé de 14 chiffres\"\n      });\n      return false;\n    }\n\n    if (this.state.controlesList.length === 0) {\n      this.setState({\n        message: 'Veuillez rentrer au moins un contrôle. Vous pourrez le modifier par la suite si besoin'\n      });\n      return false;\n    }\n\n    return true;\n  }\n\n  onSubmit() {\n    if (this.testEntries()) {\n      visitesService.postControlesByVisite({\n        ETOB_RAISON_SOCIALE: this.state.etab,\n        ETOB_SIRET: this.state.SIRET,\n        VIS_DATE: this.state.date,\n        VIS_OBSERVATIONS: this.state.observations,\n        VIS_MUTUALISEE: this.state.mutualisee,\n        VIS_CPMM: this.state.cpmm,\n        trame: this.state.trame._id === 0 ? null : this.state.trame,\n        AG_IDENT: this.props.agentIdent\n      }, this.state.controlesList).then(() => {\n        window.alert('La visite a bien été ajoutée.');\n        this.props.history.push('/dossier/' + this.props.match.params.dossierId);\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(Container, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }, this.displayMessage(this.state.message), React.createElement(Grid, {\n      style: {\n        margin: 'auto',\n        textAlign: 'left'\n      },\n      centered: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(GridRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, React.createElement(GridColumn, {\n      width: 14,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }, React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, React.createElement(Form.Checkbox, {\n      label: \"CPMM\",\n      onChange: e => this.setState({\n        cpmm: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }), React.createElement(Form.Checkbox, {\n      label: \"Visite Mutualis\\xE9e\",\n      onChange: e => this.setState({\n        mutualisee: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(DateInput, {\n      label: \"Date de la visite\",\n      name: \"date\",\n      placeholder: \"Date de la visite\",\n      required: true,\n      value: this.state.date,\n      iconPosition: \"right\",\n      onChange: (event, {\n        value\n      }) => this.setState({\n        date: value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(Form.Input, {\n      fluid: true,\n      required: true,\n      label: \"Etablissement\",\n      placeholder: \"Raison Sociale\",\n      onChange: e => this.setState({\n        etab: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }), React.createElement(Form.Input, {\n      fluid: true,\n      required: true,\n      label: \"SIRET\",\n      placeholder: \"SIRET\",\n      onChange: e => this.setState({\n        SIRET: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      style: {\n        margin: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(Grid, {\n      style: {\n        width: '100%',\n        margin: 0\n      },\n      verticalAlign: \"bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(GridRow, {\n      style: {\n        display: 'flex'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }, React.createElement(Grid.Column, {\n      width: 16,\n      style: {\n        padding: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }, React.createElement(Form.Select, {\n      fluid: true,\n      placeholder: \"Trame\",\n      label: \"Trame associ\\xE9e\",\n      style: {\n        width: '100%'\n      },\n      options: this.state.trameList.map(trame => ({\n        key: trame._id,\n        text: trame.name,\n        value: trame\n      })),\n      onChange: (e, {\n        value\n      }) => this.setState({\n        trame: value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }))))), React.createElement(Form.Group, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, React.createElement(Form.Field, {\n      width: 16,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, React.createElement(TextArea, {\n      placeholder: \"Observations\",\n      onChange: e => this.setState({\n        observations: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    })))), React.createElement(ControleComponent, {\n      dossier: {\n        id: this.props.match.params.dossierId,\n        text: this.state.dossierText\n      },\n      controles: this.state.controlesList,\n      changeControle: controlesList => this.setState({\n        controlesList\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }), React.createElement(Button, {\n      style: {\n        marginTop: '20px'\n      },\n      onClick: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, \"Valider\")))));\n  }\n\n}\n\nCreateVisiteComponent.propTypes = {\n  changeNameOfPage: PropTypes.func.isRequired,\n  changeBackUrl: PropTypes.func.isRequired,\n  changeActivePage: PropTypes.func.isRequired,\n  agentIdent: PropTypes.string.isRequired,\n  history: PropTypes.any,\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      dossierId: PropTypes.string\n    })\n  })\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CreateVisiteComponent);","map":{"version":3,"sources":["/Users/antoine/Documents/DGCCRF/dgccrf-front/src/containers/visiteCreation/createVisite.container.js"],"names":["React","Form","Grid","GridRow","GridColumn","Icon","TextArea","Button","Message","Container","DateInput","Link","PropTypes","changeNameOfPage","changeBackUrl","changeActivePage","connect","PouchDbServices","ControleComponent","visitesService","services","visite","dossierService","dossier","mapStateToProps","state","agentIdent","dataReducer","AGENT_DD_IDENT","mapDispatchToProps","dispatch","newName","newBackUrl","value","CreateVisiteComponent","Component","constructor","props","displayMessage","message","setState","marginTop","marginBottom","cpmm","mutualisee","date","etab","SIRET","observations","trame","trameList","_id","name","controlesList","dossierText","onSubmit","bind","componentDidMount","match","params","dossierId","getAllActionCode","then","actionList","getAllDocs","res","concat","catch","e","getDossierById","DOSSIER_LIBELLE","testEntries","length","postControlesByVisite","ETOB_RAISON_SOCIALE","ETOB_SIRET","VIS_DATE","VIS_OBSERVATIONS","VIS_MUTUALISEE","VIS_CPMM","AG_IDENT","window","alert","history","push","render","margin","textAlign","target","event","width","display","padding","map","key","text","id","propTypes","func","isRequired","string","any","shape"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\nimport React from 'react';\nimport {\n  Form,\n  Grid,\n  GridRow,\n  GridColumn,\n  Icon,\n  TextArea,\n  Button,\n  Message,\n  Container\n} from 'semantic-ui-react';\nimport { DateInput } from 'semantic-ui-calendar-react';\nimport { Link } from 'react-router-dom';\nimport { PropTypes } from 'prop-types';\nimport {\n  changeNameOfPage,\n  changeBackUrl,\n  changeActivePage\n} from '../navbar/actions';\nimport { connect } from 'react-redux';\nimport PouchDbServices from '../../services';\nimport ControleComponent from './controles.container';\nlet visitesService = PouchDbServices.services.visite;\nlet dossierService = PouchDbServices.services.dossier;\n\nfunction mapStateToProps(state) {\n  return {\n    agentIdent: state.dataReducer.AGENT_DD_IDENT\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    changeNameOfPage: newName => dispatch(changeNameOfPage(newName)),\n    changeBackUrl: newBackUrl => dispatch(changeBackUrl(newBackUrl)),\n    changeActivePage: value =>\n      dispatch(changeActivePage('mesDossiers', '/nouvelle-visite/' + value))\n  };\n}\n\nclass CreateVisiteComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cpmm: false,\n      mutualisee: false,\n      date: '',\n      etab: '',\n      SIRET: '',\n      observations: '',\n      trame: '',\n      trameList: [{ _id: 0, name: 'Aucune trame' }],\n      controlesList: [],\n      message: '',\n      dossierText: ''\n    };\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  async componentDidMount() {\n    this.props.changeNameOfPage('Création de visite');\n    this.props.changeBackUrl('/mes-dossiers'); // TODO : change for /dossier/:idDossier\n    this.props.changeActivePage(this.props.match.params.dossierId);\n    dossierService\n      .getAllActionCode()\n      .then(actionList => this.setState({ actionList }));\n\n    PouchDbServices.services.trame\n      .getAllDocs()\n      .then(res => {\n        this.setState({ trameList: this.state.trameList.concat(res) });\n      })\n      .catch(e => {\n        //\n      });\n    const dossier = await dossierService.getDossierById(\n      this.props.match.params.dossierId\n    );\n    this.setState({ dossierText: dossier.DOSSIER_LIBELLE });\n  }\n\n  displayMessage = message => {\n    if (message) {\n      return (\n        <Message\n          fluid\n          negative\n          onDismiss={() => this.setState({ message: '' })}\n          style={{ marginTop: '10px' }}\n        >\n          <Message.Header style={{ marginBottom: '5px' }}>\n            Validation Impossible\n          </Message.Header>\n          <Message.Content>{message}</Message.Content>\n        </Message>\n      );\n    }\n  };\n\n  testEntries() {\n    if (!this.state.etab || !this.state.date || !this.state.trame) {\n      this.setState({\n        message: \"Veillez renseigner l'ensemble des champs obligatoires\"\n      });\n      return false;\n    }\n    if (this.state.SIRET.length !== 14) {\n      this.setState({\n        message:\n          \"Le numéro SIRET renseigné n'est pas valide : il doit être composé de 14 chiffres\"\n      });\n      return false;\n    }\n    if (this.state.controlesList.length === 0) {\n      this.setState({\n        message:\n          'Veuillez rentrer au moins un contrôle. Vous pourrez le modifier par la suite si besoin'\n      });\n      return false;\n    }\n    return true;\n  }\n\n  onSubmit() {\n    if (this.testEntries()) {\n      visitesService\n        .postControlesByVisite(\n          {\n            ETOB_RAISON_SOCIALE: this.state.etab,\n            ETOB_SIRET: this.state.SIRET,\n            VIS_DATE: this.state.date,\n            VIS_OBSERVATIONS: this.state.observations,\n            VIS_MUTUALISEE: this.state.mutualisee,\n            VIS_CPMM: this.state.cpmm,\n            trame: this.state.trame._id === 0 ? null : this.state.trame,\n            AG_IDENT: this.props.agentIdent\n          },\n          this.state.controlesList\n        )\n        .then(() => {\n          window.alert('La visite a bien été ajoutée.');\n          this.props.history.push(\n            '/dossier/' + this.props.match.params.dossierId\n          );\n        });\n    }\n  }\n\n  render() {\n    return (\n      <Container>\n        {this.displayMessage(this.state.message)}\n        <Grid style={{ margin: 'auto', textAlign: 'left' }} centered>\n          <GridRow>\n            <GridColumn width={14}>\n              <Form onSubmit={this.onSubmit}>\n                <Form.Group widths=\"equal\">\n                  <Form.Checkbox\n                    label=\"CPMM\"\n                    onChange={e => this.setState({ cpmm: e.target.value })}\n                  />\n                  <Form.Checkbox\n                    label=\"Visite Mutualisée\"\n                    onChange={e =>\n                      this.setState({ mutualisee: e.target.value })\n                    }\n                  />\n                </Form.Group>\n                <Form.Group widths=\"equal\">\n                  <DateInput\n                    label=\"Date de la visite\"\n                    name=\"date\"\n                    placeholder=\"Date de la visite\"\n                    required\n                    value={this.state.date}\n                    iconPosition=\"right\"\n                    onChange={(event, { value }) =>\n                      this.setState({ date: value })\n                    }\n                  />\n                </Form.Group>\n                <Form.Group widths=\"equal\">\n                  <Form.Input\n                    fluid\n                    required\n                    label=\"Etablissement\"\n                    placeholder=\"Raison Sociale\"\n                    onChange={e => this.setState({ etab: e.target.value })}\n                  />\n\n                  <Form.Input\n                    fluid\n                    required\n                    label=\"SIRET\"\n                    placeholder=\"SIRET\"\n                    onChange={e => this.setState({ SIRET: e.target.value })}\n                  />\n                </Form.Group>\n                <Form.Group style={{ margin: 0 }}>\n                  <Grid\n                    style={{ width: '100%', margin: 0 }}\n                    verticalAlign=\"bottom\"\n                  >\n                    <GridRow style={{ display: 'flex' }}>\n                      <Grid.Column width={16} style={{ padding: 0 }}>\n                        <Form.Select\n                          fluid\n                          placeholder=\"Trame\"\n                          label=\"Trame associée\"\n                          style={{ width: '100%' }}\n                          options={this.state.trameList.map(trame => ({\n                            key: trame._id,\n                            text: trame.name,\n                            value: trame\n                          }))}\n                          onChange={(e, { value }) =>\n                            this.setState({ trame: value })\n                          }\n                        />\n                      </Grid.Column>\n                    </GridRow>\n                  </Grid>\n                </Form.Group>\n                <Form.Group>\n                  <Form.Field width={16}>\n                    <TextArea\n                      placeholder=\"Observations\"\n                      onChange={e =>\n                        this.setState({ observations: e.target.value })\n                      }\n                    />\n                  </Form.Field>\n                </Form.Group>\n              </Form>\n              <ControleComponent\n                dossier={{\n                  id: this.props.match.params.dossierId,\n                  text: this.state.dossierText\n                }}\n                controles={this.state.controlesList}\n                changeControle={controlesList =>\n                  this.setState({ controlesList })\n                }\n              />\n              <Button style={{ marginTop: '20px' }} onClick={this.onSubmit}>\n                Valider\n              </Button>\n            </GridColumn>\n          </GridRow>\n        </Grid>\n      </Container>\n    );\n  }\n}\n\nCreateVisiteComponent.propTypes = {\n  changeNameOfPage: PropTypes.func.isRequired,\n  changeBackUrl: PropTypes.func.isRequired,\n  changeActivePage: PropTypes.func.isRequired,\n  agentIdent: PropTypes.string.isRequired,\n  history: PropTypes.any,\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      dossierId: PropTypes.string\n    })\n  })\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(CreateVisiteComponent);\n"]},"metadata":{},"sourceType":"module"}