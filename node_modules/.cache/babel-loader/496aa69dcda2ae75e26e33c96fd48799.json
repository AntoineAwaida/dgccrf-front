{"ast":null,"code":"var _jsxFileName = \"/Users/antoine/Documents/DGCCRF/dgccrf-front/src/components/documents/documents.component.js\";\nimport React, { Component } from 'react';\nimport { Button, Icon, Header, Modal, Input } from 'semantic-ui-react';\nimport documentsService from '../../services/subservices/documents.service';\nimport MyActivityIndicator from '../../components/myActivityIndicator.component';\nimport DocumentModal from './documentModal.component';\nimport './documents.css';\nimport PropTypes from 'prop-types';\nimport DocumentsList from './documentsList';\nimport { Tabs, Tab } from '@material-ui/core';\nimport SwipeableViews from 'react-swipeable-views';\nimport PouchdbServices from '../../services';\nlet visitesService = PouchdbServices.services.visite; // blobs, pour chrome\n// function openDocument(document) {\n//   const base64ImageData = document.document;\n//   const contentType = document.type;\n//   const byteCharacters = atob(\n//     base64ImageData.substr(`data:${contentType};base64,`.length)\n//   );\n//   const byteArrays = [];\n//   for (let offset = 0; offset < byteCharacters.length; offset += 1024) {\n//     const slice = byteCharacters.slice(offset, offset + 1024);\n//     const byteNumbers = new Array(slice.length);\n//     for (let i = 0; i < slice.length; i++) {\n//       byteNumbers[i] = slice.charCodeAt(i);\n//     }\n//     const byteArray = new Uint8Array(byteNumbers);\n//     byteArrays.push(byteArray);\n//   }\n//   const blob = new Blob(byteArrays, { type: contentType });\n//   const blobUrl = URL.createObjectURL(blob);\n//   window.open(blobUrl, '_blank');\n// }\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = () => resolve(reader.result);\n\n    reader.onerror = error => reject(error);\n  });\n}\n\nclass Documents extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this.handleChange = (event, value) => {\n      this.setState({\n        activeIndex: value\n      });\n    };\n\n    this.handleChangeIndex = value => {\n      this.setState({\n        activeIndex: value\n      });\n    };\n\n    this.exportToSora = () => {\n      visitesService.exportToSora(this.props.match.params.id);\n    };\n\n    this.fileInputRef = React.createRef();\n\n    this.fileChange = e => {\n      this.setState({\n        file: e.target.files[0]\n      }, async () => {\n        try {\n          const file = this.state.file;\n          const file64 = await getBase64(this.state.file);\n          await documentsService.postDocument({\n            document: file64,\n            name: file.name,\n            type: file.type,\n            author: 4447,\n            visite: this.props.dossier ? this.props.visitesList.map(visite => {\n              return visite.visiteData.VISITE_IDENT;\n            }) : [this.props.visiteid],\n            date: Date.now(),\n            dossier: this.props.dossier ? this.props.dossierid : null,\n            categorie: this.state.activeIndex === 0 ? 'support' : 'joint'\n          });\n          console.log('File sent!'); //ne pas oublier de resize l'image si c'est une image...\n        } catch (e) {\n          console.log('Error while sending file.');\n        }\n      });\n    };\n\n    this.state = {\n      file: null,\n      documents: null,\n      activeIndex: 0\n    };\n    this.reader = new FileReader();\n  }\n\n  loadDocuments(documents) {\n    documents.sort((a, b) => a.date > b.date ? 1 : -1);\n    this.setState({\n      documents\n    });\n  }\n\n  componentDidMount() {\n    this.props.dossier ? documentsService.getDocsByDossierId(this.props.dossierid).then(res => {\n      this.loadDocuments(res);\n    }) : documentsService.getDocsByVisiteId(this.props.visiteid).then(res => {\n      this.loadDocuments(res);\n    });\n    documentsService.onChanges(() => this.props.dossier ? documentsService.getDocsByDossierId(this.props.dossierid).then(res => {\n      this.loadDocuments(res);\n    }) : documentsService.getDocsByVisiteId(this.props.visiteid).then(res => {\n      this.loadDocuments(res);\n    }));\n  }\n\n  render() {\n    const documents = this.state.documents;\n    console.log(this.props.dossier);\n    return React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, this.props.visitesList || this.props.visiteid ? React.createElement(\"div\", {\n      style: {\n        flex: 1\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, !this.props.dossier && React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        marginBottom: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, React.createElement(Button, {\n      icon: true,\n      style: {\n        position: 'absolute',\n        right: 10,\n        marginTop: 4\n      },\n      labelPosition: \"left\",\n      onClick: () => this.setState({\n        editMode: true\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"pencil\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }), \"Exporter\"), React.createElement(Tabs, {\n      value: this.state.activeIndex,\n      fullWidth: true,\n      onChange: this.handleChange,\n      TabIndicatorProps: {\n        style: {\n          backgroundColor: '#00b5ad'\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, React.createElement(Tab, {\n      label: \"Supports\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }), React.createElement(Tab, {\n      label: \"Joints\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }), React.createElement(Tab, {\n      label: \"Photos\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }))), this.state.activeIndex != 2 && React.createElement(React.Fragment, null, React.createElement(Button, {\n      style: {\n        background: '#3C4586',\n        color: 'white'\n      },\n      content: \"Ajouter un fichier\",\n      labelPosition: \"left\",\n      icon: \"file\",\n      onClick: () => this.fileInputRef.current.click(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      ref: this.fileInputRef,\n      type: \"file\",\n      hidden: true,\n      onChange: this.fileChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }))) : React.createElement(MyActivityIndicator, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }), documents ? React.createElement(\"div\", {\n      style: {\n        flex: 10,\n        overflowY: 'auto'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, this.props.dossier ? React.createElement(DocumentsList, {\n      documents: documents.filter(document => {\n        return document.categorie === 'support';\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }) : React.createElement(SwipeableViews, {\n      style: {\n        height: '100%'\n      },\n      slideStyle: {\n        height: '100%',\n        overflow: 'auto'\n      },\n      slideClassName: \"hidescrollbar\",\n      index: this.state.activeIndex,\n      onChangeIndex: this.handleChangeIndex,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, React.createElement(DocumentsList, {\n      documents: documents.filter(document => {\n        return document.categorie === 'support';\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }), React.createElement(DocumentsList, {\n      documents: documents.filter(document => {\n        return document.categorie === 'joint';\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }), React.createElement(DocumentsList, {\n      documents: documents.filter(document => {\n        return document.categorie === 'photo';\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }))) : React.createElement(MyActivityIndicator, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }));\n  }\n\n}\n\nDocuments.propTypes = {\n  dossierid: PropTypes.number,\n  visitesList: PropTypes.array,\n  dossier: PropTypes.bool,\n  visiteid: PropTypes.number\n};\nexport default Documents;","map":{"version":3,"sources":["/Users/antoine/Documents/DGCCRF/dgccrf-front/src/components/documents/documents.component.js"],"names":["React","Component","Button","Icon","Header","Modal","Input","documentsService","MyActivityIndicator","DocumentModal","PropTypes","DocumentsList","Tabs","Tab","SwipeableViews","PouchdbServices","visitesService","services","visite","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","Documents","constructor","props","context","handleChange","event","value","setState","activeIndex","handleChangeIndex","exportToSora","match","params","id","fileInputRef","createRef","fileChange","e","target","files","state","file64","postDocument","document","name","type","author","dossier","visitesList","map","visiteData","VISITE_IDENT","visiteid","date","Date","now","dossierid","categorie","console","log","documents","loadDocuments","sort","a","b","componentDidMount","getDocsByDossierId","then","res","getDocsByVisiteId","onChanges","render","display","flexDirection","height","flex","justifyContent","alignItems","marginBottom","position","right","marginTop","editMode","style","backgroundColor","background","color","current","click","overflowY","filter","overflow","propTypes","number","array","bool"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Button, Icon, Header, Modal, Input } from 'semantic-ui-react';\nimport documentsService from '../../services/subservices/documents.service';\nimport MyActivityIndicator from '../../components/myActivityIndicator.component';\nimport DocumentModal from './documentModal.component';\n\nimport './documents.css';\n\nimport PropTypes from 'prop-types';\nimport DocumentsList from './documentsList';\nimport { Tabs, Tab } from '@material-ui/core';\n\nimport SwipeableViews from 'react-swipeable-views';\n\nimport PouchdbServices from '../../services';\nlet visitesService = PouchdbServices.services.visite;\n\n// blobs, pour chrome\n\n// function openDocument(document) {\n//   const base64ImageData = document.document;\n//   const contentType = document.type;\n\n//   const byteCharacters = atob(\n//     base64ImageData.substr(`data:${contentType};base64,`.length)\n//   );\n//   const byteArrays = [];\n\n//   for (let offset = 0; offset < byteCharacters.length; offset += 1024) {\n//     const slice = byteCharacters.slice(offset, offset + 1024);\n\n//     const byteNumbers = new Array(slice.length);\n//     for (let i = 0; i < slice.length; i++) {\n//       byteNumbers[i] = slice.charCodeAt(i);\n//     }\n\n//     const byteArray = new Uint8Array(byteNumbers);\n\n//     byteArrays.push(byteArray);\n//   }\n//   const blob = new Blob(byteArrays, { type: contentType });\n//   const blobUrl = URL.createObjectURL(blob);\n\n//   window.open(blobUrl, '_blank');\n// }\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n}\nclass Documents extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      file: null,\n      documents: null,\n      activeIndex: 0\n    };\n    this.reader = new FileReader();\n  }\n\n  handleChange = (event, value) => {\n    this.setState({\n      activeIndex: value\n    });\n  };\n  handleChangeIndex = value => {\n    this.setState({\n      activeIndex: value\n    });\n  };\n\n  loadDocuments(documents) {\n    documents.sort((a, b) => (a.date > b.date ? 1 : -1));\n    this.setState({ documents });\n  }\n\n  componentDidMount() {\n    this.props.dossier\n      ? documentsService.getDocsByDossierId(this.props.dossierid).then(res => {\n        this.loadDocuments(res);\n      })\n      : documentsService.getDocsByVisiteId(this.props.visiteid).then(res => {\n        this.loadDocuments(res);\n      });\n\n    documentsService.onChanges(() =>\n      this.props.dossier\n        ? documentsService\n          .getDocsByDossierId(this.props.dossierid)\n          .then(res => {\n            this.loadDocuments(res);\n          })\n        : documentsService.getDocsByVisiteId(this.props.visiteid).then(res => {\n          this.loadDocuments(res);\n        })\n    );\n  }\n\n  exportToSora = () => {\n    visitesService.exportToSora(this.props.match.params.id);\n  }\n\n  fileInputRef = React.createRef();\n\n  fileChange = e => {\n    this.setState({ file: e.target.files[0] }, async () => {\n      try {\n        const { file } = this.state;\n\n        const file64 = await getBase64(this.state.file);\n        await documentsService.postDocument({\n          document: file64,\n          name: file.name,\n          type: file.type,\n          author: 4447,\n          visite: this.props.dossier\n            ? this.props.visitesList.map(visite => {\n              return visite.visiteData.VISITE_IDENT;\n            })\n            : [this.props.visiteid],\n          date: Date.now(),\n          dossier: this.props.dossier ? this.props.dossierid : null,\n          categorie: this.state.activeIndex === 0 ? 'support' : 'joint'\n        });\n        console.log('File sent!');\n        //ne pas oublier de resize l'image si c'est une image...\n      } catch (e) {\n        console.log('Error while sending file.');\n      }\n    });\n  };\n\n  render() {\n    const { documents } = this.state;\n    console.log(this.props.dossier);\n\n    return (\n      <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\n        {this.props.visitesList || this.props.visiteid ? (\n          <div style={{ flex: 1 }}>\n            {!this.props.dossier && (\n              <div\n                style={{\n                  display: 'flex',\n                  justifyContent: 'center',\n                  alignItems: 'center',\n                  marginBottom: 20\n                }}\n              >\n                <Button\n                  icon\n                  style={{ position: 'absolute', right: 10, marginTop: 4 }}\n                  labelPosition=\"left\"\n                  onClick={() => this.setState({ editMode: true })}\n                >\n                  <Icon name=\"pencil\"></Icon>\n                  Exporter\n                </Button>\n\n                <Tabs\n                  value={this.state.activeIndex}\n                  fullWidth\n                  onChange={this.handleChange}\n                  TabIndicatorProps={{ style: { backgroundColor: '#00b5ad' } }}\n                >\n                  <Tab label=\"Supports\" />\n\n                  <Tab label=\"Joints\" />\n\n                  <Tab label=\"Photos\" />\n                </Tabs>\n              </div>\n            )}\n            {this.state.activeIndex != 2 && (\n              <>\n                <Button\n                  style={{\n                    background: '#3C4586',\n                    color: 'white'\n                  }}\n                  content=\"Ajouter un fichier\"\n                  labelPosition=\"left\"\n                  icon=\"file\"\n                  onClick={() => this.fileInputRef.current.click()}\n                />\n                <input\n                  ref={this.fileInputRef}\n                  type=\"file\"\n                  hidden\n                  onChange={this.fileChange}\n                />\n              </>\n            )}\n          </div>\n        ) : (\n            <MyActivityIndicator />\n          )}\n\n        {documents ? (\n          <div style={{ flex: 10, overflowY: 'auto' }}>\n            {this.props.dossier ? (\n              <DocumentsList\n                documents={documents.filter(document => {\n                  return document.categorie === 'support';\n                })}\n              />\n            ) : (\n                <SwipeableViews\n                  style={{ height: '100%' }}\n                  slideStyle={{ height: '100%', overflow: 'auto' }}\n                  slideClassName=\"hidescrollbar\"\n                  index={this.state.activeIndex}\n                  onChangeIndex={this.handleChangeIndex}\n                >\n                  <DocumentsList\n                    documents={documents.filter(document => {\n                      return document.categorie === 'support';\n                    })}\n                  />\n\n                  <DocumentsList\n                    documents={documents.filter(document => {\n                      return document.categorie === 'joint';\n                    })}\n                  />\n                  <DocumentsList\n                    documents={documents.filter(document => {\n                      return document.categorie === 'photo';\n                    })}\n                  />\n                </SwipeableViews>\n              )}\n          </div>\n        ) : (\n            <MyActivityIndicator />\n          )}\n      </div>\n    );\n  }\n}\n\nDocuments.propTypes = {\n  dossierid: PropTypes.number,\n  visitesList: PropTypes.array,\n  dossier: PropTypes.bool,\n  visiteid: PropTypes.number\n};\n\nexport default Documents;\n"]},"metadata":{},"sourceType":"module"}