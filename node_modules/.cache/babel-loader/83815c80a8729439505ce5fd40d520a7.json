{"ast":null,"code":"var _jsxFileName = \"/Users/antoine/Documents/DGCCRF/dgccrf-front/src/containers/visiteCreation/createVisite.container.js\";\n\n/* eslint-disable no-undef */\nimport React from 'react';\nimport { Form, Grid, GridRow, GridColumn, Icon, TextArea, Button, Message, Container } from 'semantic-ui-react';\nimport { DateInput } from 'semantic-ui-calendar-react';\nimport { Link } from 'react-router-dom';\nimport { PropTypes } from 'prop-types';\nimport { changeNameOfPage, changeBackUrl, changeActivePage } from '../navbar/actions';\nimport { connect } from 'react-redux';\nimport PouchDbServices from '../../services';\nimport ControleComponent from './controles.container';\nlet visitesService = PouchDbServices.services.visite;\nlet dossierService = PouchDbServices.services.dossier;\n\nfunction mapStateToProps(state) {\n  return {\n    agentIdent: state.dataReducer.AGENT_DD_IDENT\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    changeNameOfPage: newName => dispatch(changeNameOfPage(newName)),\n    changeBackUrl: newBackUrl => dispatch(changeBackUrl(newBackUrl)),\n    changeActivePage: value => dispatch(changeActivePage('mesDossiers', '/nouvelle-visite/' + value))\n  };\n}\n\nclass CreateVisiteComponent extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.displayMessage = message => {\n      if (message) {\n        return React.createElement(Message, {\n          fluid: true,\n          negative: true,\n          onDismiss: () => this.setState({\n            message: ''\n          }),\n          style: {\n            marginTop: '10px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78\n          },\n          __self: this\n        }, React.createElement(Message.Header, {\n          style: {\n            marginBottom: '5px'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84\n          },\n          __self: this\n        }, \"Validation Impossible\"), React.createElement(Message.Content, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        }, message));\n      }\n    };\n\n    this.state = {\n      cpmm: false,\n      mutualisee: false,\n      date: '',\n      etab: '',\n      SIRET: '',\n      observations: '',\n      trame: '',\n      trameList: ['trame 1', 'trame 2'],\n      controlesList: [],\n      message: '',\n      dossierText: ''\n    };\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  async componentDidMount() {\n    this.props.changeNameOfPage('Création de visite');\n    this.props.changeBackUrl('/mes-dossiers'); // TODO : change for /dossier/:idDossier\n\n    this.props.changeActivePage(this.props.match.params.dossierId);\n    dossierService.getAllActionCode().then(actionList => this.setState({\n      actionList\n    }));\n    const dossier = await dossierService.getDossierById(this.props.match.params.dossierId);\n    this.setState({\n      dossierText: dossier.DOSSIER_LIBELLE\n    });\n  }\n\n  testEntries() {\n    if (!this.state.etab || !this.state.date || !this.state.trame) {\n      this.setState({\n        message: \"Veillez renseigner l'ensemble des champs obligatoires\"\n      });\n      return false;\n    }\n\n    if (this.state.SIRET.length !== 14) {\n      this.setState({\n        message: \"Le numéro SIRET renseigné n'est pas valide : il doit être composé de 14 chiffres\"\n      });\n      return false;\n    }\n\n    if (this.state.controlesList.length === 0) {\n      this.setState({\n        message: 'Veuillez rentrer au moins un contrôle. Vous pourrez le modifier par la suite si besoin'\n      });\n      return false;\n    }\n\n    return true;\n  }\n\n  onSubmit() {\n    if (this.testEntries()) {\n      visitesService.postControlesByVisite({\n        ETOB_RAISON_SOCIALE: this.state.etab,\n        ETOB_SIRET: this.state.SIRET,\n        VIS_DATE: this.state.date,\n        VIS_OBSERVATIONS: this.state.observations,\n        VIS_MUTUALISEE: this.state.mutualisee,\n        VIS_CPMM: this.state.cpmm,\n        trame: this.state.trame,\n        AG_IDENT: this.props.agentIdent\n      }, this.state.controlesList).then(() => {\n        window.alert('La visite a bien été ajoutée.');\n        this.props.history.push('/dossier/' + this.props.match.params.dossierId);\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(Container, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, this.displayMessage(this.state.message), React.createElement(Grid, {\n      style: {\n        margin: 'auto',\n        textAlign: 'left'\n      },\n      centered: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, React.createElement(GridRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, React.createElement(GridColumn, {\n      width: 14,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }, React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }, React.createElement(Form.Checkbox, {\n      label: \"CPMM\",\n      onChange: e => this.setState({\n        cpmm: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }), React.createElement(Form.Checkbox, {\n      label: \"Visite Mutualis\\xE9e\",\n      onChange: e => this.setState({\n        mutualisee: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, React.createElement(DateInput, {\n      label: \"Date de la visite\",\n      name: \"date\",\n      placeholder: \"Date de la visite\",\n      required: true,\n      value: this.state.date,\n      iconPosition: \"right\",\n      onChange: (event, {\n        value\n      }) => this.setState({\n        date: value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      widths: \"equal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, React.createElement(Form.Input, {\n      fluid: true,\n      required: true,\n      label: \"Etablissement\",\n      placeholder: \"Raison Sociale\",\n      onChange: e => this.setState({\n        etab: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }), React.createElement(Form.Input, {\n      fluid: true,\n      required: true,\n      label: \"SIRET\",\n      placeholder: \"SIRET\",\n      onChange: e => this.setState({\n        SIRET: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    })), React.createElement(Form.Group, {\n      style: {\n        margin: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, React.createElement(Grid, {\n      style: {\n        width: '100%',\n        margin: 0\n      },\n      verticalAlign: \"bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, React.createElement(GridRow, {\n      style: {\n        display: 'flex'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(Grid.Column, {\n      width: 14,\n      style: {\n        padding: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(Form.Select, {\n      fluid: true,\n      placeholder: \"Tr\\xE2me\",\n      label: \"Tr\\xE2me associ\\xE9e\",\n      style: {\n        width: '100%'\n      },\n      options: this.state.trameList.map(trame => ({\n        key: trame,\n        text: trame,\n        value: trame\n      })),\n      onChange: (e, {\n        value\n      }) => this.setState({\n        trame: value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    })), React.createElement(Grid.Column, {\n      width: 1,\n      style: {\n        padding: 0\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/nouvelle-trame\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        width: '100%',\n        textAlign: 'center',\n        cursor: 'pointer',\n        paddingBottom: '0.3em'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"plus\",\n      size: \"big\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }))))))), React.createElement(Form.Group, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(Form.Field, {\n      width: 16,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, React.createElement(TextArea, {\n      placeholder: \"Observations\",\n      onChange: e => this.setState({\n        observations: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    })))), React.createElement(ControleComponent, {\n      dossier: {\n        id: this.props.match.params.dossierId,\n        text: this.state.dossierText\n      },\n      controles: this.state.controlesList,\n      changeControle: controlesList => this.setState({\n        controlesList\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }), React.createElement(Button, {\n      style: {\n        marginTop: '20px'\n      },\n      onClick: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253\n      },\n      __self: this\n    }, \"Valider\")))));\n  }\n\n}\n\nCreateVisiteComponent.propTypes = {\n  changeNameOfPage: PropTypes.func.isRequired,\n  changeBackUrl: PropTypes.func.isRequired,\n  changeActivePage: PropTypes.func.isRequired,\n  agentIdent: PropTypes.string.isRequired,\n  history: PropTypes.any,\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      dossierId: PropTypes.string\n    })\n  })\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(CreateVisiteComponent);","map":{"version":3,"sources":["/Users/antoine/Documents/DGCCRF/dgccrf-front/src/containers/visiteCreation/createVisite.container.js"],"names":["React","Form","Grid","GridRow","GridColumn","Icon","TextArea","Button","Message","Container","DateInput","Link","PropTypes","changeNameOfPage","changeBackUrl","changeActivePage","connect","PouchDbServices","ControleComponent","visitesService","services","visite","dossierService","dossier","mapStateToProps","state","agentIdent","dataReducer","AGENT_DD_IDENT","mapDispatchToProps","dispatch","newName","newBackUrl","value","CreateVisiteComponent","Component","constructor","props","displayMessage","message","setState","marginTop","marginBottom","cpmm","mutualisee","date","etab","SIRET","observations","trame","trameList","controlesList","dossierText","onSubmit","bind","componentDidMount","match","params","dossierId","getAllActionCode","then","actionList","getDossierById","DOSSIER_LIBELLE","testEntries","length","postControlesByVisite","ETOB_RAISON_SOCIALE","ETOB_SIRET","VIS_DATE","VIS_OBSERVATIONS","VIS_MUTUALISEE","VIS_CPMM","AG_IDENT","window","alert","history","push","render","margin","textAlign","e","target","event","width","display","padding","map","key","text","cursor","paddingBottom","id","propTypes","func","isRequired","string","any","shape"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\nimport React from 'react';\nimport {\n  Form,\n  Grid,\n  GridRow,\n  GridColumn,\n  Icon,\n  TextArea,\n  Button,\n  Message,\n  Container\n} from 'semantic-ui-react';\nimport { DateInput } from 'semantic-ui-calendar-react';\nimport { Link } from 'react-router-dom';\nimport { PropTypes } from 'prop-types';\nimport {\n  changeNameOfPage,\n  changeBackUrl,\n  changeActivePage\n} from '../navbar/actions';\nimport { connect } from 'react-redux';\nimport PouchDbServices from '../../services';\nimport ControleComponent from './controles.container';\nlet visitesService = PouchDbServices.services.visite;\nlet dossierService = PouchDbServices.services.dossier;\n\nfunction mapStateToProps(state) {\n  return {\n    agentIdent: state.dataReducer.AGENT_DD_IDENT\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    changeNameOfPage: newName => dispatch(changeNameOfPage(newName)),\n    changeBackUrl: newBackUrl => dispatch(changeBackUrl(newBackUrl)),\n    changeActivePage: value =>\n      dispatch(changeActivePage('mesDossiers', '/nouvelle-visite/' + value))\n  };\n}\n\nclass CreateVisiteComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cpmm: false,\n      mutualisee: false,\n      date: '',\n      etab: '',\n      SIRET: '',\n      observations: '',\n      trame: '',\n      trameList: ['trame 1', 'trame 2'],\n      controlesList: [],\n      message: '',\n      dossierText: ''\n    };\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  async componentDidMount() {\n    this.props.changeNameOfPage('Création de visite');\n    this.props.changeBackUrl('/mes-dossiers'); // TODO : change for /dossier/:idDossier\n    this.props.changeActivePage(this.props.match.params.dossierId);\n    dossierService\n      .getAllActionCode()\n      .then(actionList => this.setState({ actionList }));\n    const dossier = await dossierService.getDossierById(\n      this.props.match.params.dossierId\n    );\n    this.setState({ dossierText: dossier.DOSSIER_LIBELLE });\n  }\n\n  displayMessage = message => {\n    if (message) {\n      return (\n        <Message\n          fluid\n          negative\n          onDismiss={() => this.setState({ message: '' })}\n          style={{ marginTop: '10px' }}\n        >\n          <Message.Header style={{ marginBottom: '5px' }}>\n            Validation Impossible\n          </Message.Header>\n          <Message.Content>{message}</Message.Content>\n        </Message>\n      );\n    }\n  };\n\n  testEntries() {\n    if (!this.state.etab || !this.state.date || !this.state.trame) {\n      this.setState({\n        message: \"Veillez renseigner l'ensemble des champs obligatoires\"\n      });\n      return false;\n    }\n    if (this.state.SIRET.length !== 14) {\n      this.setState({\n        message:\n          \"Le numéro SIRET renseigné n'est pas valide : il doit être composé de 14 chiffres\"\n      });\n      return false;\n    }\n    if (this.state.controlesList.length === 0) {\n      this.setState({\n        message:\n          'Veuillez rentrer au moins un contrôle. Vous pourrez le modifier par la suite si besoin'\n      });\n      return false;\n    }\n    return true;\n  }\n\n  onSubmit() {\n    if (this.testEntries()) {\n      visitesService\n        .postControlesByVisite(\n          {\n            ETOB_RAISON_SOCIALE: this.state.etab,\n            ETOB_SIRET: this.state.SIRET,\n            VIS_DATE: this.state.date,\n            VIS_OBSERVATIONS: this.state.observations,\n            VIS_MUTUALISEE: this.state.mutualisee,\n            VIS_CPMM: this.state.cpmm,\n            trame: this.state.trame,\n            AG_IDENT: this.props.agentIdent\n          },\n          this.state.controlesList\n        )\n        .then(() => {\n          window.alert('La visite a bien été ajoutée.');\n          this.props.history.push(\n            '/dossier/' + this.props.match.params.dossierId\n          );\n        });\n    }\n  }\n\n  render() {\n    return (\n      <Container>\n        {this.displayMessage(this.state.message)}\n        <Grid style={{ margin: 'auto', textAlign: 'left' }} centered>\n          <GridRow>\n            <GridColumn width={14}>\n              <Form onSubmit={this.onSubmit}>\n                <Form.Group widths=\"equal\">\n                  <Form.Checkbox\n                    label=\"CPMM\"\n                    onChange={e => this.setState({ cpmm: e.target.value })}\n                  />\n                  <Form.Checkbox\n                    label=\"Visite Mutualisée\"\n                    onChange={e =>\n                      this.setState({ mutualisee: e.target.value })\n                    }\n                  />\n                </Form.Group>\n                <Form.Group widths=\"equal\">\n                  <DateInput\n                    label=\"Date de la visite\"\n                    name=\"date\"\n                    placeholder=\"Date de la visite\"\n                    required\n                    value={this.state.date}\n                    iconPosition=\"right\"\n                    onChange={(event, { value }) =>\n                      this.setState({ date: value })\n                    }\n                  />\n                </Form.Group>\n                <Form.Group widths=\"equal\">\n                  <Form.Input\n                    fluid\n                    required\n                    label=\"Etablissement\"\n                    placeholder=\"Raison Sociale\"\n                    onChange={e => this.setState({ etab: e.target.value })}\n                  />\n\n                  <Form.Input\n                    fluid\n                    required\n                    label=\"SIRET\"\n                    placeholder=\"SIRET\"\n                    onChange={e => this.setState({ SIRET: e.target.value })}\n                  />\n                </Form.Group>\n                <Form.Group style={{ margin: 0 }}>\n                  <Grid\n                    style={{ width: '100%', margin: 0 }}\n                    verticalAlign=\"bottom\"\n                  >\n                    <GridRow style={{ display: 'flex' }}>\n                      <Grid.Column width={14} style={{ padding: 0 }}>\n                        <Form.Select\n                          fluid\n                          placeholder=\"Trâme\"\n                          label=\"Trâme associée\"\n                          style={{ width: '100%' }}\n                          options={this.state.trameList.map(trame => ({\n                            key: trame,\n                            text: trame,\n                            value: trame\n                          }))}\n                          onChange={(e, { value }) =>\n                            this.setState({ trame: value })\n                          }\n                        />\n                      </Grid.Column>\n\n                      <Grid.Column width={1} style={{ padding: 0 }}>\n                        <Link to=\"/nouvelle-trame\">\n                          <div\n                            style={{\n                              width: '100%',\n                              textAlign: 'center',\n                              cursor: 'pointer',\n                              paddingBottom: '0.3em'\n                            }}\n                          >\n                            <Icon name=\"plus\" size=\"big\" />\n                          </div>\n                        </Link>\n                      </Grid.Column>\n                    </GridRow>\n                  </Grid>\n                </Form.Group>\n                <Form.Group>\n                  <Form.Field width={16}>\n                    <TextArea\n                      placeholder=\"Observations\"\n                      onChange={e =>\n                        this.setState({ observations: e.target.value })\n                      }\n                    />\n                  </Form.Field>\n                </Form.Group>\n              </Form>\n              <ControleComponent\n                dossier={{\n                  id: this.props.match.params.dossierId,\n                  text: this.state.dossierText\n                }}\n                controles={this.state.controlesList}\n                changeControle={controlesList =>\n                  this.setState({ controlesList })\n                }\n              />\n              <Button style={{ marginTop: '20px' }} onClick={this.onSubmit}>\n                Valider\n              </Button>\n            </GridColumn>\n          </GridRow>\n        </Grid>\n      </Container>\n    );\n  }\n}\n\nCreateVisiteComponent.propTypes = {\n  changeNameOfPage: PropTypes.func.isRequired,\n  changeBackUrl: PropTypes.func.isRequired,\n  changeActivePage: PropTypes.func.isRequired,\n  agentIdent: PropTypes.string.isRequired,\n  history: PropTypes.any,\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      dossierId: PropTypes.string\n    })\n  })\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(CreateVisiteComponent);\n"]},"metadata":{},"sourceType":"module"}