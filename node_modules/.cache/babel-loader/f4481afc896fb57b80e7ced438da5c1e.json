{"ast":null,"code":"import PouchDB from 'pouchdb';\nimport PouchDBFind from 'pouchdb-find';\nimport config from '../config';\nPouchDB.plugin(PouchDBFind);\n\nclass PouchDbService {\n  constructor() {\n    let pouchDbUrl = config.couchDb.url_dossiers;\n    this.db = new PouchDB('mes-dossiers');\n    var opts = {\n      batch_size: 1000,\n      live: true,\n      retry: true,\n      'filter': '_view',\n      'view': 'mydesign/myview',\n      query_params: {\n        key: 4447\n      }\n    };\n    this.db.replicate.from(pouchDbUrl, opts);\n    this.db.createIndex({\n      index: {\n        fields: ['DOSSIER_IDENT']\n      }\n    });\n    this.db.createIndex({\n      index: {\n        fields: ['ACDG_CODE_ACTION']\n      }\n    });\n  } //call the callback on db changes\n\n\n  onChanges(cb) {\n    this.db.changes({\n      since: 'now',\n      live: true\n    }).on('change', cb);\n  } //getAllDocsOfTheDB\n\n\n  getAllDocs() {\n    return this.db.allDocs({\n      include_docs: true,\n      descending: true\n    }).then(table => table.rows.map(item => item.doc).filter(item => !(item._id.split('/')[0] == '_design')));\n  }\n\n  getAllActionCode() {\n    return this.getAllDocs().then(array => array.map(item => item.ACDG_CODE_ACTION).filter((value, index, self) => self.indexOf(value) === index));\n  }\n\n  getDossierIdFromActionCode(actionCode) {\n    return this.db.find({\n      selector: {\n        ACDG_CODE_ACTION: actionCode\n      }\n    }).then(items => items.docs[0].DOSSIER_IDENT);\n  }\n\n  getDossierById(dossier) {\n    return this.db.find({\n      selector: {\n        DOSSIER_IDENT: parseInt(dossier)\n      }\n    }).then(res => res.docs[0]);\n  }\n\n}\n\nexport default PouchDbService;","map":{"version":3,"sources":["/Users/antoine/Documents/DGCCRF/dgccrf-front/src/services/dossier.service.js"],"names":["PouchDB","PouchDBFind","config","plugin","PouchDbService","constructor","pouchDbUrl","couchDb","url_dossiers","db","opts","batch_size","live","retry","query_params","key","replicate","from","createIndex","index","fields","onChanges","cb","changes","since","on","getAllDocs","allDocs","include_docs","descending","then","table","rows","map","item","doc","filter","_id","split","getAllActionCode","array","ACDG_CODE_ACTION","value","self","indexOf","getDossierIdFromActionCode","actionCode","find","selector","items","docs","DOSSIER_IDENT","getDossierById","dossier","parseInt","res"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,SAApB;AACA,OAAOC,WAAP,MAAwB,cAAxB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEAF,OAAO,CAACG,MAAR,CAAeF,WAAf;;AACA,MAAMG,cAAN,CAAqB;AACjBC,EAAAA,WAAW,GAAG;AACV,QAAIC,UAAU,GAAGJ,MAAM,CAACK,OAAP,CAAeC,YAAhC;AACA,SAAKC,EAAL,GAAU,IAAIT,OAAJ,CAAY,cAAZ,CAAV;AACA,QAAIU,IAAI,GAAG;AACPC,MAAAA,UAAU,EAAE,IADL;AAEPC,MAAAA,IAAI,EAAE,IAFC;AAGPC,MAAAA,KAAK,EAAE,IAHA;AAIP,gBAAU,OAJH;AAKP,cAAQ,iBALD;AAMPC,MAAAA,YAAY,EAAE;AAAEC,QAAAA,GAAG,EAAE;AAAP;AANP,KAAX;AAQA,SAAKN,EAAL,CAAQO,SAAR,CAAkBC,IAAlB,CAAuBX,UAAvB,EAAmCI,IAAnC;AACA,SAAKD,EAAL,CAAQS,WAAR,CAAoB;AAChBC,MAAAA,KAAK,EAAE;AAAEC,QAAAA,MAAM,EAAE,CAAC,eAAD;AAAV;AADS,KAApB;AAGA,SAAKX,EAAL,CAAQS,WAAR,CAAoB;AAChBC,MAAAA,KAAK,EAAE;AAAEC,QAAAA,MAAM,EAAE,CAAC,kBAAD;AAAV;AADS,KAApB;AAGH,GAnBgB,CAqBjB;;;AACAC,EAAAA,SAAS,CAACC,EAAD,EAAK;AACV,SAAKb,EAAL,CACKc,OADL,CACa;AACLC,MAAAA,KAAK,EAAE,KADF;AAELZ,MAAAA,IAAI,EAAE;AAFD,KADb,EAKKa,EALL,CAKQ,QALR,EAKkBH,EALlB;AAMH,GA7BgB,CA+BjB;;;AACAI,EAAAA,UAAU,GAAG;AACT,WAAO,KAAKjB,EAAL,CACFkB,OADE,CACM;AAAEC,MAAAA,YAAY,EAAE,IAAhB;AAAsBC,MAAAA,UAAU,EAAE;AAAlC,KADN,EAEFC,IAFE,CAEGC,KAAK,IACPA,KAAK,CAACC,IAAN,CACKC,GADL,CACSC,IAAI,IAAIA,IAAI,CAACC,GADtB,EAEKC,MAFL,CAEYF,IAAI,IAAI,EAAEA,IAAI,CAACG,GAAL,CAASC,KAAT,CAAe,GAAf,EAAoB,CAApB,KAA0B,SAA5B,CAFpB,CAHD,CAAP;AAOH;;AAEDC,EAAAA,gBAAgB,GAAG;AACf,WAAO,KAAKb,UAAL,GAAkBI,IAAlB,CAAuBU,KAAK,IAC/BA,KAAK,CACAP,GADL,CACSC,IAAI,IAAIA,IAAI,CAACO,gBADtB,EAEKL,MAFL,CAEY,CAACM,KAAD,EAAQvB,KAAR,EAAewB,IAAf,KAAwBA,IAAI,CAACC,OAAL,CAAaF,KAAb,MAAwBvB,KAF5D,CADG,CAAP;AAKH;;AAED0B,EAAAA,0BAA0B,CAACC,UAAD,EAAa;AACnC,WAAO,KAAKrC,EAAL,CACFsC,IADE,CACG;AACFC,MAAAA,QAAQ,EAAE;AACNP,QAAAA,gBAAgB,EAAEK;AADZ;AADR,KADH,EAMFhB,IANE,CAMGmB,KAAK,IAAIA,KAAK,CAACC,IAAN,CAAW,CAAX,EAAcC,aAN1B,CAAP;AAOH;;AAEDC,EAAAA,cAAc,CAACC,OAAD,EAAU;AACpB,WAAO,KAAK5C,EAAL,CACFsC,IADE,CACG;AACFC,MAAAA,QAAQ,EAAE;AACNG,QAAAA,aAAa,EAAEG,QAAQ,CAACD,OAAD;AADjB;AADR,KADH,EAMFvB,IANE,CAMGyB,GAAG,IAAIA,GAAG,CAACL,IAAJ,CAAS,CAAT,CANV,CAAP;AAOH;;AApEgB;;AAuErB,eAAe9C,cAAf","sourcesContent":["import PouchDB from 'pouchdb';\nimport PouchDBFind from 'pouchdb-find';\nimport config from '../config';\n\nPouchDB.plugin(PouchDBFind);\nclass PouchDbService {\n    constructor() {\n        let pouchDbUrl = config.couchDb.url_dossiers;\n        this.db = new PouchDB('mes-dossiers');\n        var opts = {\n            batch_size: 1000,\n            live: true,\n            retry: true,\n            'filter': '_view',\n            'view': 'mydesign/myview',\n            query_params: { key: 4447 }\n        };\n        this.db.replicate.from(pouchDbUrl, opts);\n        this.db.createIndex({\n            index: { fields: ['DOSSIER_IDENT'] }\n        });\n        this.db.createIndex({\n            index: { fields: ['ACDG_CODE_ACTION'] }\n        });\n    }\n\n    //call the callback on db changes\n    onChanges(cb) {\n        this.db\n            .changes({\n                since: 'now',\n                live: true\n            })\n            .on('change', cb);\n    }\n\n    //getAllDocsOfTheDB\n    getAllDocs() {\n        return this.db\n            .allDocs({ include_docs: true, descending: true })\n            .then(table =>\n                table.rows\n                    .map(item => item.doc)\n                    .filter(item => !(item._id.split('/')[0] == '_design'))\n            );\n    }\n\n    getAllActionCode() {\n        return this.getAllDocs().then(array =>\n            array\n                .map(item => item.ACDG_CODE_ACTION)\n                .filter((value, index, self) => self.indexOf(value) === index)\n        );\n    }\n\n    getDossierIdFromActionCode(actionCode) {\n        return this.db\n            .find({\n                selector: {\n                    ACDG_CODE_ACTION: actionCode\n                }\n            })\n            .then(items => items.docs[0].DOSSIER_IDENT);\n    }\n\n    getDossierById(dossier) {\n        return this.db\n            .find({\n                selector: {\n                    DOSSIER_IDENT: parseInt(dossier)\n                }\n            })\n            .then(res => res.docs[0]);\n    }\n}\n\nexport default PouchDbService;\n"]},"metadata":{},"sourceType":"module"}